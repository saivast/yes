local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer

-- 1. SAFE PATH LOADING
local zones = Workspace:WaitForChild("World"):WaitForChild("Zones")
local winterLevel = zones:WaitForChild("Level_WinterWonderland")
local giftFolder = winterLevel:WaitForChild("Gift_Collectible")

-- Configuration
local WAIT_TIME = 0.25      
local VOID_LIMIT = -243     
local HEIGHT_OFFSET = 3     

-- Helper Function: Keeps the player floating
local function enableFloat(rootPart)
	if not rootPart:FindFirstChild("AntiFallVelocity") then
		local bodyVel = Instance.new("BodyVelocity")
		bodyVel.Name = "AntiFallVelocity"
		bodyVel.Velocity = Vector3.zero
		bodyVel.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
		bodyVel.Parent = rootPart
	end
end

-- Helper Function: Safely finds where to teleport
local function getTargetCFrame(obj)
	if obj:IsA("BasePart") then return obj.CFrame
	elseif obj:IsA("Model") then
		if obj.PrimaryPart then return obj.PrimaryPart.CFrame end
		local firstPart = obj:FindFirstChildWhichIsA("BasePart")
		if firstPart then return firstPart.CFrame end
		local pivot = obj:GetPivot()
		if pivot then return pivot end
	end
	return nil
end

local function teleportToGifts()
	local character = player.Character or player.CharacterAdded:Wait()
	local rootPart = character:WaitForChild("HumanoidRootPart")
	enableFloat(rootPart)

	local gifts = giftFolder:GetChildren()
    -- Only run if there are actually gifts
    if #gifts == 0 then return end

	for _, gift in ipairs(gifts) do
		if not character or not rootPart or not rootPart.Parent then
			character = player.Character or player.CharacterAdded:Wait()
			rootPart = character:WaitForChild("HumanoidRootPart")
			enableFloat(rootPart)
		end

		local targetCFrame = getTargetCFrame(gift)
		if targetCFrame then
			local presentHeight = targetCFrame.Position.Y
			if presentHeight > VOID_LIMIT then
				local safePosition = targetCFrame * CFrame.new(0, HEIGHT_OFFSET, 0)
				rootPart.CFrame = safePosition
				rootPart.AssemblyLinearVelocity = Vector3.zero 
				rootPart.AssemblyAngularVelocity = Vector3.zero
				task.wait(WAIT_TIME)
			end
		end
	end
	
	if rootPart:FindFirstChild("AntiFallVelocity") then
		rootPart.AntiFallVelocity:Destroy()
	end
end

-- EXECUTE ONCE (Loop removed so Server Hop can take over)
teleportToGifts()
